- name: Create disk for Boostrap VM
  command: "qemu-img create -f qcow2 -b /var/lib/libvirt/images/rhcos-qemu.qcow2 /var/lib/libvirt/images/{{ item }}.qcow2 {{ bootstrap_node_disksize }}"
  delegate_to: "{{ hostvars[item]['kvm_host'] }}"
  with_items: "{{ groups['bootstrap'] }}"
- name: Create disk for Master VM's
  command: "qemu-img create -f qcow2 -b /var/lib/libvirt/images/rhcos-qemu.qcow2 /var/lib/libvirt/images/{{ item }}.qcow2 {{ master_node_disksize }}"
  delegate_to: "{{ hostvars[item]['kvm_host'] }}"
  with_items: "{{ groups['masters'] }}"
- shell:
    cmd: virt-install --name {{ item }} --memory {{ bootstrap_node_memory }} --vcpus {{ bootstrap_node_cpu }} --cpu {{ cpu_model }} --disk path=/var/lib/libvirt/images/{{ item }}.qcow2,format=qcow2,bus=virtio,io=threads --hvm --network bridge=br0,mac={{ hostvars[item]['ethernet'] }},model=virtio --boot hd --os-variant rhel8.0 --keymap=de-de --noautoconsole --qemu-commandline="-fw_cfg name=opt/com.coreos/config,file=/var/lib/libvirt/images/bootstrap.ign"
  delegate_to: "{{ hostvars[item]['kvm_host'] }}"
  with_items: "{{ groups['bootstrap'] }}"
- shell:
    cmd: virt-install --name {{ item }} --memory {{ master_node_memory }} --vcpus {{ master_node_cpu }} --cpu {{ cpu_model }} --disk path=/var/lib/libvirt/images/{{ item }}.qcow2,format=qcow2,bus=virtio,io=threads --hvm --network bridge=br0,mac={{ hostvars[item]['ethernet'] }},model=virtio --boot hd --os-variant rhel8.0 --keymap=de-de --noautoconsole --qemu-commandline="-fw_cfg name=opt/com.coreos/config,file=/var/lib/libvirt/images/master.ign"
  delegate_to: "{{ hostvars[item]['kvm_host'] }}"
  with_items: "{{ groups['masters'] }}"
